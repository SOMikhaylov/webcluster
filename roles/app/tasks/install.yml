- name: install percona repository
  yum: 
    name: https://repo.percona.com/yum/percona-release-latest.noarch.rpm
    state: present

- name: disable default mysql module
  copy:
    content: |
      [mysql]
      name=mysql
      profiles=
      state=disabled
      stream=
    dest: /etc/dnf/modules.d/mysql.module
  when: ansible_distribution_version|int >= 8

- name: install packages
  yum:
    name:
      - nginx
      - php-fpm
      - Percona-XtraDB-Cluster-client-57
      - proxysql2
      - php-mysqlnd
      - php-json
    state: present

- name: pip install PyMySQL module
  pip: 
    name: PyMySQL
    state: present